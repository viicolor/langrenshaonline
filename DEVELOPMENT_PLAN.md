# 狼人杀游戏开发计划

## 项目概述

**项目名称**: 狼人杀游戏平台
**项目类型**: Web游戏 + 后台管理系统
**技术栈**: React + TypeScript + Supabase + AI集成
**开发周期**: 预计6-8周

---

## 需求确认总结

### 用户确认的配置选项

| 配置项 | 选择 |
|--------|------|
| AI模型集成 | OpenAI (GPT-4/GPT-3.5)、通义千问/文心一言、MCP协议集成、先做接口预留 |
| 用户认证 | 用户名密码 |
| 后台权限 | 管理员权限 |
| 记录导出 | Markdown文档 |
| 板子配置 | 预设板子 |
| AI发言显示 | 可配置 |
| 观战视角切换 | 选择后不可切换 |
| 游戏记录保存 | 先做手动 |

---

## 开发阶段划分

### 第一阶段：基础架构搭建（第1-2周）

#### 目标
完成项目基础架构、UI规范、核心组件库

#### 任务清单

##### 1.1 项目初始化
- [ ] 初始化项目结构
- [ ] 配置TypeScript严格模式
- [ ] 配置ESLint和Prettier
- [ ] 配置Git Hooks (Husky)
- [ ] 创建开发环境配置文件

##### 1.2 UI设计规范实现
- [ ] 更新Tailwind配置（添加角色色彩、动画等）
- [ ] 创建全局CSS变量
- [ ] 实现基础样式（按钮、卡片、输入框等）
- [ ] 创建设计系统文档

##### 1.3 基础组件开发
- [ ] 扩展shadcn-ui组件
  - [ ] Button组件变体（主要、次要、幽灵、图标按钮）
  - [ ] Card组件变体（房间卡片、角色卡片、玩家卡片）
  - [ ] Input组件变体（文本、下拉、复选框、单选框）
- [ ] 创建自定义组件
  - [ ] RoundTable组件（圆桌布局）
  - [ ] RoleCard组件（角色卡片）
  - [ ] RoomCard组件（房间卡片）
  - [ ] CountdownOverlay组件（倒计时遮罩）

##### 1.4 状态管理搭建
- [ ] 配置TanStack Query
- [ ] 创建全局状态Store（Zustand或Context）
  - [ ] gameStore（游戏状态）
  - [ ] roomStore（房间状态）
  - [ ] userStore（用户状态）

##### 1.5 路由配置
- [ ] 配置React Router
- [ ] 创建基础页面组件
  - [ ] Index页面（首页）
  - [ ] Login页面（登录）
  - [ ] Lobby页面（游戏大厅）
  - [ ] GameRoom页面（游戏房间）
  - [ ] Spectator页面（观战模式）
  - [ ] Admin页面（后台管理）
  - [ ] NotFound页面（404）

##### 1.6 数据库设计
- [ ] 设计数据库表结构
- [ ] 创建Supabase迁移文件
- [ ] 配置Supabase客户端
- [ ] 创建类型定义（types/supabase.ts）

**交付物**:
- 完整的项目结构
- UI设计规范文档
- 基础组件库
- 数据库表结构

---

### 第二阶段：用户认证与游戏大厅（第3周）

#### 目标
完成用户登录注册功能和游戏大厅

#### 任务清单

##### 2.1 用户认证系统
- [ ] 实现登录页面UI
- [ ] 实现注册页面UI
- [ ] 集成Supabase Auth
  - [ ] 登录功能
  - [ ] 注册功能
  - [ ] 登出功能
  - [ ] 密码重置功能
- [ ] 实现认证状态管理
- [ ] 添加路由守卫（未登录重定向）

##### 2.2 游戏大厅
- [ ] 实现房间列表展示
- [ ] 实现创建房间对话框
  - [ ] 房间名称输入
  - [ ] 板子选择（预设板子）
  - [ ] AI玩家数量配置
  - [ ] 最大玩家数设置
- [ ] 实现房间卡片组件
  - [ ] 房间信息展示
  - [ ] 玩家数量显示
  - [ ] 房间状态显示
  - [ ] 加入/观战按钮
- [ ] 实现房间列表实时更新（WebSocket）
- [ ] 实现刷新房间列表功能

##### 2.3 板子配置
- [ ] 创建预设板子数据
  - [ ] 12人标准局（4狼4民4神）
  - [ ] 9人局（3狼3民3神）
  - [ ] 6人局（2狼2民2神）
- [ ] 实现板子选择组件
- [ ] 实现板子信息展示

**交付物**:
- 完整的用户认证系统
- 功能完整的游戏大厅
- 预设板子配置

---

### 第三阶段：游戏房间核心功能（第4-5周）

#### 目标
完成游戏房间的核心游戏逻辑

#### 任务清单

##### 3.1 房间管理
- [ ] 实现房间创建API
- [ ] 实现房间加入API
- [ ] 实现房间离开API
- [ ] 实现房间状态管理
- [ ] 实现玩家准备功能
- [ ] 实现房主权限控制

##### 3.2 圆桌布局
- [ ] 实现圆桌座位布局（12个座位）
- [ ] 实现玩家头像展示
- [ ] 实现玩家状态标记
  - [ ] 房主标记（皇冠图标）
  - [ ] 准备状态标记
  - [ ] 死亡状态标记（骷髅图标）
  - [ ] 当前玩家高亮
- [ ] 实现座位点击交互

##### 3.3 游戏流程
- [ ] 实现游戏阶段管理
  - [ ] 等待阶段
  - [ ] 倒计时阶段
  - [ ] 夜晚阶段
  - [ ] 白天阶段
  - [ ] 投票阶段
  - [ ] 结束阶段
- [ ] 实现角色分配
  - [ ] 随机分配角色
  - [ ] 角色卡片展示
  - [ ] 角色信息隐藏（非自己角色）
- [ ] 实现游戏倒计时
- [ ] 实现阶段转换动画

##### 3.4 聊天系统
- [ ] 实现聊天输入框
- [ ] 实现消息发送功能
- [ ] 实现消息展示列表
  - [ ] 玩家发言
  - [ ] 系统消息
  - [ ] 投票消息
  - [ ] 技能使用消息
- [ ] 实现消息滚动（最新消息在底部）
- [ ] 实现消息时间戳

##### 3.5 投票系统
- [ ] 实现投票UI
- [ ] 实现投票功能
- [ ] 实现投票结果展示
- [ ] 实现投票统计
- [ ] 实现投票超时处理

##### 3.6 角色技能
- [ ] 实现预言家查验功能
- [ ] 实现女巫技能
  - [ ] 解药使用
  - [ ] 毒药使用
  - [ ] 每晚限制
- [ ] 实现猎人开枪功能
- [ ] 实现守卫守护功能
- [ ] 实现白痴翻牌功能
- [ ] 实现狼人杀人功能

##### 3.7 游戏结束
- [ ] 实现胜负判断
- [ ] 实现游戏结束展示
- [ ] 实现游戏统计
  - [ ] 存活玩家
  - [ ] 死亡玩家
  - [ ] MVP评选
- [ ] 实现返回大厅功能

**交付物**:
- 完整的游戏房间功能
- 所有角色技能实现
- 游戏流程完整

---

### 第四阶段：观战系统（第5-6周）

#### 目标
完成观战模式和游戏记录功能

#### 任务清单

##### 4.1 观战入口
- [ ] 实现观战模式选择
  - [ ] 上桌参与游戏
  - [ ] 进入观战模式
- [ ] 实现观战房间布局

##### 4.2 观战视角选择
- [ ] 实现视角选择对话框
  - [ ] 跟随指定玩家视角
  - [ ] 跟随指定身份牌视角
  - [ ] 上帝视角
- [ ] 实现视角选择限制（一次性选择，不可切换）
- [ ] 保存观战视角选择

##### 4.3 观战信息过滤
- [ ] 实现消息过滤器
  - [ ] 跟随玩家视角：只显示该玩家和系统消息
  - [ ] 跟随身份视角：只显示该身份玩家和系统消息
  - [ ] 上帝视角：显示所有消息
- [ ] 实现实时消息推送（过滤后）
- [ ] 实现观战信息区展示
  - [ ] 当前视角显示
  - [ ] 观战人数显示

##### 4.4 观战记录区
- [ ] 实现实时滚动消息列表
- [ ] 实现消息分类展示
  - [ ] 发言消息
  - [ ] 投票消息
  - [ ] 技能使用消息
  - [ ] 系统消息
- [ ] 实现消息时间排序
- [ ] 实现消息高亮（重要消息）

##### 4.5 游戏记录保存
- [ ] 实现游戏记录数据结构
- [ ] 实现游戏记录保存API
- [ ] 实现手动保存功能
  - [ ] 保存按钮
  - [ ] 保存确认对话框
- [ ] 实现游戏记录导出
  - [ ] Markdown格式导出
  - [ ] 按玩家和时间排序
  - [ ] 文件下载功能
- [ ] 实现游戏记录列表
- [ ] 实现游戏记录查看

**交付物**:
- 完整的观战系统
- 三种观战视角实现
- 游戏记录保存和导出功能

---

### 第五阶段：AI玩家系统（第6-7周）

#### 目标
完成AI玩家集成和角色扮演

#### 任务清单

##### 5.1 AI接口架构
- [ ] 设计AI服务接口
  - [ ] AIPlayerService接口定义
  - [ ] 统一的AI调用规范
- [ ] 创建AI配置管理
  - [ ] API配置存储
  - [ ] 模型配置存储
  - [ ] 配置加密存储

##### 5.2 OpenAI集成
- [ ] 集成OpenAI SDK
- [ ] 实现OpenAIService
  - [ ] 消息生成
  - [ ] 决策生成
  - [ ] 技能使用判断
- [ ] 实现角色扮演Prompt
  - [ ] 狼人角色Prompt
  - [ ] 预言家角色Prompt
  - [ ] 女巫角色Prompt
  - [ ] 猎人角色Prompt
  - [ ] 守卫角色Prompt
  - [ ] 白痴角色Prompt
  - [ ] 村民角色Prompt
- [ ] 实现API调用优化
  - [ ] 请求缓存
  - [ ] 错误重试
  - [ ] 限流控制

##### 5.3 通义千问集成
- [ ] 集成通义千问SDK
- [ ] 实现QwenService
  - [ ] 消息生成
  - [ ] 决策生成
  - [ ] 技能使用判断
- [ ] 复用OpenAI的Prompt模板

##### 5.4 MCP协议集成
- [ ] 设计MCP协议接口
- [ ] 实现MCPService
  - [ ] 连接管理
  - [ ] 消息发送
  - [ ] 响应处理
- [ ] 实现MCP配置界面

##### 5.5 AI玩家管理
- [ ] 实现AI玩家自动分配
  - [ ] 自动生成用户名
  - [ ] 随机分配头像
- [ ] 实现AI玩家状态管理
- [ ] 实现AI玩家列表展示
- [ ] 实现AI玩家发言显示
  - [ ] 纯文字模式
  - [ ] 文字+AI标识模式（可配置）

##### 5.6 AI游戏逻辑
- [ ] 实现AI玩家加入游戏
- [ ] 实现AI玩家发言触发
  - [ ] 白天发言
  - [ ] 投票发言
  - [ ] 死亡遗言
- [ ] 实现AI玩家投票
  - [ ] 投票决策
  - [ ] 投票提交
- [ ] 实现AI玩家技能使用
  - [ ] 技能使用判断
  - [ ] 技能目标选择
  - [ ] 技能执行
- [ ] 实现多AI并发控制

##### 5.7 AI配置界面（后台）
- [ ] 实现AI配置列表
- [ ] 实现AI配置添加
  - [ ] 选择提供商（OpenAI/通义千问/MCP）
  - [ ] 输入API Key
  - [ ] 选择模型
  - [ ] 配置端点
- [ ] 实现AI配置编辑
- [ ] 实现AI配置删除
- [ ] 实现AI配置测试
- [ ] 实现AI配置启用/禁用

**交付物**:
- 完整的AI玩家系统
- OpenAI、通义千问、MCP集成
- AI角色扮演功能
- AI配置管理界面

---

### 第六阶段：后台管理系统（第7-8周）

#### 目标
完成后台管理所有功能

#### 任务清单

##### 6.1 后台布局
- [ ] 实现侧边栏导航
- [ ] 实现主内容区
- [ ] 实现响应式布局
- [ ] 实现权限控制（仅管理员可访问）

##### 6.2 AI接口管理
- [ ] 实现AI配置管理（已在5.7完成）
- [ ] 实现AI使用统计
  - [ ] API调用次数
  - [ ] Token消耗
  - [ ] 成本统计
- [ ] 实现AI性能监控
  - [ ] 响应时间
  - [ ] 错误率

##### 6.3 游戏规则维护
- [ ] 实现游戏规则列表
- [ ] 实现规则编辑
  - [ ] 夜晚时长
  - [ ] 白天时长
  - [ ] 投票时长
  - [ ] 技能使用规则
- [ ] 实现规则版本管理
- [ ] 实现规则应用

##### 6.4 角色牌库管理
- [ ] 实现角色列表
- [ ] 实现角色添加
  - [ ] 角色名称
  - [ ] 角色描述
  - [ ] 角色技能描述
  - [ ] 角色图标
- [ ] 实现角色编辑
- [ ] 实现角色删除
- [ ] 实现角色技能配置
- [ ] 实现角色阵营配置

##### 6.5 板子设计维护
- [ ] 实现板子列表
- [ ] 实现板子创建
  - [ ] 板子名称
  - [ ] 板子描述
  - [ ] 玩家人数
  - [ ] 角色配置（数量和类型）
- [ ] 实现板子编辑
- [ ] 实现板子删除
- [ ] 实现板子复制
- [ ] 实现板子设为默认
- [ ] 实现板子预览

##### 6.6 数据统计
- [ ] 实现游戏统计
  - [ ] 游戏场次
  - [ ] 玩家人数
  - [ ] 胜率统计
- [ ] 实现玩家统计
  - [ ] 玩家活跃度
  - [ ] 胜率排行
  - [ ] MVP次数
- [ ] 实现AI统计
  - [ ] AI使用率
  - [ ] AI胜率
- [ ] 实现数据可视化（图表）

##### 6.7 系统设置
- [ ] 实现系统配置
  - [ ] 系统名称
  - [ ] 系统Logo
  - [ ] 系统描述
- [ ] 实现管理员管理
  - [ ] 管理员列表
  - [ ] 添加管理员
  - [ ] 移除管理员
- [ ] 实现日志查看
  - [ ] 操作日志
  - [ ] 错误日志
  - [ ] 日志筛选和导出

**交付物**:
- 完整的后台管理系统
- 所有配置管理功能
- 数据统计和可视化

---

### 第七阶段：测试与优化（第8周）

#### 目标
完成测试、性能优化和部署准备

#### 任务清单

##### 7.1 功能测试
- [ ] 编写单元测试
  - [ ] 组件测试
  - [ ] 工具函数测试
  - [ ] 服务层测试
- [ ] 编写集成测试
  - [ ] 页面流程测试
  - [ ] API集成测试
- [ ] 执行端到端测试
  - [ ] 用户注册登录流程
  - [ ] 创建房间流程
  - [ ] 游戏完整流程
  - [ ] 观战流程
  - [ ] 后台管理流程

##### 7.2 性能优化
- [ ] 前端性能优化
  - [ ] 代码分割
  - [ ] 懒加载
  - [ ] 图片优化
  - [ ] 缓存优化
- [ ] 数据库优化
  - [ ] 添加索引
  - [ ] 查询优化
  - [ ] 连接池配置
- [ ] WebSocket优化
  - [ ] 连接管理
  - [ ] 消息压缩
  - [ ] 重连策略

##### 7.3 安全加固
- [ ] 安全审计
  - [ ] SQL注入检查
  - [ ] XSS攻击检查
  - [ ] CSRF防护
- [ ] 权限验证
  - [ ] 所有API权限检查
  - [ ] 前端路由守卫
- [ ] 数据加密
  - [ ] API Key加密存储
  - [ ] 敏感数据加密

##### 7.4 用户体验优化
- [ ] 加载状态优化
- [ ] 错误提示优化
- [ ] 动画流畅度优化
- [ ] 响应式适配
- [ ] 无障碍优化

##### 7.5 文档完善
- [ ] API文档
- [ ] 组件文档
- [ ] 用户手册
- [ ] 部署文档
- [ ] 运维文档

##### 7.6 部署准备
- [ ] 环境变量配置
- [ ] CI/CD配置
- [ ] 部署脚本
- [ ] 监控配置
- [ ] 备份策略

**交付物**:
- 完整的测试覆盖
- 性能优化报告
- 安全审计报告
- 完整的项目文档
- 部署就绪的应用

---

## 里程碑

| 里程碑 | 时间 | 交付内容 |
|--------|------|---------|
| M1: 基础架构完成 | 第2周末 | 项目结构、UI规范、基础组件、数据库设计 |
| M2: 游戏大厅完成 | 第3周末 | 用户认证、游戏大厅、板子配置 |
| M3: 游戏房间完成 | 第5周末 | 完整游戏流程、所有角色技能 |
| M4: 观战系统完成 | 第6周末 | 三种观战视角、游戏记录保存 |
| M5: AI系统完成 | 第7周末 | AI集成、角色扮演、AI配置管理 |
| M6: 后台管理完成 | 第8周末 | 所有管理功能、数据统计 |
| M7: 项目发布 | 第8周末 | 测试完成、优化完成、部署就绪 |

---

## 风险管理

### 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| AI API限流 | 高 | 中 | 实现请求队列、多模型支持 |
| WebSocket连接不稳定 | 中 | 中 | 实现重连机制、降级方案 |
| 性能问题 | 中 | 中 | 代码分割、虚拟滚动、缓存优化 |
| 数据库性能瓶颈 | 中 | 低 | 索引优化、查询优化、连接池 |

### 进度风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 需求变更 | 高 | 中 | 敏捷开发、快速迭代 |
| 技术难点 | 中 | 中 | 提前调研、寻求帮助 |
| 人员变动 | 中 | 低 | 文档完善、知识共享 |

---

## 资源需求

### 人力资源

| 角色 | 人数 | 职责 |
|------|------|------|
| 前端开发 | 1-2人 | React组件、页面开发 |
| 后端开发 | 1人 | API开发、数据库设计 |
| AI集成 | 1人 | AI服务集成、Prompt优化 |
| 测试 | 1人 | 测试用例编写、质量保证 |
| 设计 | 1人 | UI设计、交互设计 |

### 技术资源

- 开发环境：Node.js 18+、Git
- 前端框架：React 18、TypeScript 5
- 后端服务：Supabase
- AI服务：OpenAI API、通义千问API
- 开发工具：VS Code、Git、Postman

---

## 质量标准

### 代码质量

- TypeScript覆盖率：100%
- ESLint通过率：100%
- 单元测试覆盖率：>80%
- 集成测试覆盖率：>60%

### 性能标准

- 首屏加载时间：<3秒
- 交互响应时间：<100ms
- WebSocket延迟：<50ms
- API响应时间：<200ms

### 用户体验

- 界面美观度：符合UI设计规范
- 交互流畅度：无明显卡顿
- 错误提示：清晰友好
- 响应式适配：支持主流设备

---

## 后续规划

### V1.1版本（发布后1个月）

- 语音转文字功能
- 游戏回放功能
- 更多预设板子
- AI模型扩展（Claude、Gemini等）

### V1.2版本（发布后3个月）

- 移动端App
- 排位赛系统
- 成就系统
- 社交功能（好友、聊天）

### V2.0版本（发布后6个月）

- 自定义板子编辑器
- 游戏录像分享
- AI训练系统
- 多语言支持

---

## 附录：开发规范

### Git工作流

```bash
# 创建功能分支
git checkout -b feature/ai-player

# 开发并提交
git add .
git commit -m "feat: 实现AI玩家基础功能"

# 推送到远程
git push origin feature/ai-player

# 创建Pull Request
# 代码审查通过后合并到develop分支
```

### 提交信息规范

```
<type>(<scope>): <subject>

<body>

<footer>
```

类型：
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 重构
- test: 测试相关
- chore: 构建/工具相关

### 代码审查清单

- [ ] 代码符合TypeScript严格模式
- [ ] 代码符合ESLint规则
- [ ] 添加了必要的注释
- [ ] 更新了相关文档
- [ ] 通过了所有测试
- [ ] 没有引入新的警告

---

**文档版本**: v1.0.0
**创建日期**: 2026-01-31
**最后更新**: 2026-01-31
**维护者**: 开发团队
