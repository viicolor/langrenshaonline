<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ³¨å†Œæµ‹è¯•ç”¨æˆ·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
      font-size: 28px;
    }
    .info {
      background: #e3f2fd;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    .info h3 {
      margin: 0 0 10px 0;
      color: #3b82f6;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      background: #f9f9f9;
    }
    input:focus {
      border-color: #667eea;
      outline: none;
      background: white;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 40px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      margin-top: 20px;
      width: 100%;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 6px;
      display: none;
      font-size: 16px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }
    .info-box {
      background: #d1ecf1;
      color: #0c5460;
      border: 2px solid #bee5eb;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ® æ³¨å†Œæµ‹è¯•ç”¨æˆ·</h1>
    
    <div class="info">
      <h3>ğŸ“‹ ç”¨æˆ·ä¿¡æ¯</h3>
      <p><strong>ç”¨æˆ·åï¼š</strong>viicolor</p>
      <p><strong>å¯†ç ï¼š</strong>123456</p>
      <p><strong>é‚®ç®±ï¼š</strong>viicolor@test.com</p>
    </div>
    
    <div class="form-group">
      <label for="username">ç”¨æˆ·åï¼ˆåªè¯»ï¼‰ï¼š</label>
      <input type="text" id="username" value="viicolor" readonly>
    </div>
    
    <div class="form-group">
      <label for="password">å¯†ç ï¼ˆåªè¯»ï¼‰ï¼š</label>
      <input type="text" id="password" value="123456" readonly>
    </div>
    
    <div class="form-group">
      <label for="email">é‚®ç®±ï¼ˆåªè¯»ï¼‰ï¼š</label>
      <input type="text" id="email" value="viicolor@test.com" readonly>
    </div>
    
    <button id="registerBtn" onclick="registerUser()">
      <span id="btnText">ğŸš€ ç‚¹å‡»æ³¨å†Œç”¨æˆ·</span>
    </button>
    
    <div id="result"></div>
  </div>

  <script>
    const SUPABASE_URL = 'https://ioquklhxeisulnagkauo.supabase.co';
    const SUPABASE_PUBLISHABLE_KEY = 'sb_publishable_HK_oRlUyVk61zsUH42gkTw_8XnRrByV';

    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
    }

    async function registerUser() {
      const username = 'viicolor';
      const password = '123456';
      const email = 'viicolor@test.com';
      
      const resultDiv = document.getElementById('result');
      const registerBtn = document.getElementById('registerBtn');
      const btnText = document.getElementById('btnText');
      
      resultDiv.style.display = 'none';
      registerBtn.disabled = true;
      btnText.innerHTML = '<span class="loading"></span> æ³¨å†Œä¸­...';
      
      try {
        showResult('info-box', 'ğŸ” æ£€æŸ¥ç”¨æˆ·å...');
        
        const checkUrl = `${SUPABASE_URL}/rest/v1/users?username=eq.${encodeURIComponent(username)}&select=id`;
        const checkResponse = await fetch(checkUrl, {
          headers: {
            'apikey': SUPABASE_PUBLISHABLE_KEY,
            'Content-Type': 'application/json',
          },
        });
        
        const checkData = await checkResponse.json();
        
        if (checkData && checkData.length > 0) {
          showResult('error', 'âŒ ç”¨æˆ·åå·²å­˜åœ¨ï¼');
          registerBtn.disabled = false;
          btnText.textContent = 'ğŸš€ ç‚¹å‡»æ³¨å†Œç”¨æˆ·';
          return;
        }
        
        showResult('info-box', 'ğŸ” åŠ å¯†å¯†ç ...');
        const passwordHash = await hashPassword(password);
        
        showResult('info-box', 'ğŸ“ åˆ›å»ºç”¨æˆ·...');
        
        const registerUrl = `${SUPABASE_URL}/rest/v1/users`;
        const userData = {
          username,
          password_hash: passwordHash,
          email,
          avatar_url: `https://api.dicebear.com/7.x/adventurer/svg?seed=${username}`,
        };
        
        const registerResponse = await fetch(registerUrl, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_PUBLISHABLE_KEY,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation',
          },
          body: JSON.stringify(userData),
        });
        
        const result = await registerResponse.json();
        
        if (result.error) {
          showResult('error', `âŒ æ³¨å†Œå¤±è´¥ï¼š${result.error.message || 'æœªçŸ¥é”™è¯¯'}`);
          console.error('æ³¨å†Œå¤±è´¥:', result.error);
        } else {
          showResult('success', `âœ… æ³¨å†ŒæˆåŠŸï¼<br><br>ğŸ“‹ ç”¨æˆ·ä¿¡æ¯ï¼š<br>â€¢ ç”¨æˆ·IDï¼š${result.id}<br>â€¢ ç”¨æˆ·åï¼š${result.username}<br>â€¢ é‚®ç®±ï¼š${result.email}<br>â€¢ å¤´åƒï¼š${result.avatar_url}<br>â€¢ åˆ›å»ºæ—¶é—´ï¼š${result.created_at}`);
          console.log('æ³¨å†ŒæˆåŠŸ:', result);
        }
        
      } catch (error) {
        console.error('æ³¨å†Œé”™è¯¯:', error);
        showResult('error', `âŒ æ³¨å†Œå‡ºé”™ï¼š${error.message}`);
      } finally {
        registerBtn.disabled = false;
        btnText.textContent = 'ğŸš€ ç‚¹å‡»æ³¨å†Œç”¨æˆ·';
      }
    }
    
    function showResult(type, message) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = type;
      resultDiv.innerHTML = message;
      resultDiv.style.display = 'block';
    }
    
    console.log('âœ… é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡æ³¨å†Œ');
    console.log('ğŸ”— Supabase URL:', SUPABASE_URL);
    console.log('ğŸ‘¤ ç”¨æˆ·å: viicolor');
    console.log('ğŸ”‘ å¯†ç : 123456');
  </script>
</body>
</html>
